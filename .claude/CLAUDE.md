# Claude Instructions for This Repository

This is a chezmoi-managed dotfiles repository supporting Ubuntu (Nix Home Manager) and Windows (Scoop/uv).

## File Editing Rules

### Chezmoi Template Syntax

Files ending in `.tmpl` use Go template syntax:
- `{{ .chezmoi.os }}` - OS name ("linux", "windows", "darwin")
- `{{ .profile }}` - Profile ("client" or "server")
- `{{ .is_wsl }}` - Boolean for WSL environment

### OS/Profile Guards

Use empty template pattern to skip files entirely:
```
{{- if eq .chezmoi.os "windows" -}}
# Windows-only content here
{{- end -}}
```

For scripts, combine profile and OS:
```
{{- if and (eq .chezmoi.os "windows") (eq .profile "client") -}}
# Content
{{- end -}}
```

### Script Naming Convention

```
run_{once,onchange,after_onchange}_{profile}_{os}_{number}-{name}.{sh,ps1}.tmpl
```

Examples:
- `run_once_client_ubuntu_010-install-nix.sh.tmpl`
- `run_onchange_client_windows_120-python-uv.ps1.tmpl`

### Cross-Platform Code

When writing code that runs on both platforms:
```lua
local is_win = vim.fn.has("win32") == 1
local path = is_win and "C:\\path" or "/path"
```

## Verification

Always verify changes before committing:

```bash
chezmoi diff                 # Show what would change
chezmoi apply --dry-run -v   # Verbose dry run
chezmoi apply                # Apply changes
```

## Coding Standards

### Shell Scripts (Linux)
- Use `set -euo pipefail`
- 2-space indentation (Google Shell Style Guide)

### PowerShell Scripts (Windows)
- Use `$ErrorActionPreference = 'Stop'`
- Use `Set-StrictMode -Version Latest`

### Lua (Neovim)
- Follow existing LazyVim patterns
- Use `opts = function(_, opts)` for extending defaults

## Git Commit Rules

- Follow Conventional Commits **without scope**: `type: message`
- Types: `feat`, `fix`, `docs`, `chore`, `refactor`
- Write in English
- No AI attribution or "generated by" messages
- Check `git log` for style reference

## Warnings

- **DO NOT** modify file permissions on `install.sh` (causes issues on Windows)
- **DO NOT** use `echo` or bash commands for user communication - use direct text output
- **DO NOT** create new documentation files unless explicitly requested
- **ALWAYS** test cross-platform compatibility when editing shared configs (nvim, etc.)
- **ALWAYS** use `chezmoi apply --dry-run` before applying changes
