# =============================================================================
# tmux Plugin Configuration (TPM)
# =============================================================================

# =============================================================================
# Plugin List
# =============================================================================

# TPM (Tmux Plugin Manager)
set -g @plugin 'tmux-plugins/tpm'

# Session persistence (matches Zellij session_serialization)
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Clipboard integration (enhances copy-mode)
set -g @plugin 'tmux-plugins/tmux-yank'

# =============================================================================
# TPM Keybinding Configuration
# =============================================================================
# Avoid conflict with prefix + I (swap-window -t -1, Zellij compatible)
# P = Plugins mnemonic

set -g @tpm-install 'P'    # prefix + P: Install plugins
set -g @tpm-update 'U'     # prefix + U: Update plugins
set -g @tpm-clean 'M'      # prefix + M: Remove/clean plugins

# =============================================================================
# tmux-resurrect Configuration
# =============================================================================

# Restore pane contents
set -g @resurrect-capture-pane-contents 'on'

# Restore neovim sessions
set -g @resurrect-strategy-nvim 'session'

# Save directory
set -g @resurrect-dir '~/.local/share/tmux/resurrect'

# =============================================================================
# tmux-continuum Configuration
# =============================================================================

# Auto-save interval (minutes)
set -g @continuum-save-interval '15'

# Auto-restore on tmux start
set -g @continuum-restore 'on'

# =============================================================================
# tmux-yank Configuration
# =============================================================================

# Use system clipboard
set -g @yank_selection_mouse 'clipboard'

# Stay in copy mode after yanking
set -g @yank_action 'copy-pipe'

# Override copy command (unified clipboard script handles all environments)
# Use @override_copy_command (highest priority) instead of @custom_copy_command
# to bypass clip.exe which has UTF-16 encoding issues with Japanese characters
set -g @override_copy_command 'clipboard-copy'

# =============================================================================
# Initialize TPM
# NOTE: Keep this at the very bottom of plugins.conf
# =============================================================================

# Set plugin manager path (required for TPM)
set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.tmux/plugins'

# Auto-install TPM if not present
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/tpm'"

# Initialize TPM
run '~/.tmux/plugins/tpm/tpm'
