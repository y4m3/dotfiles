# =============================================================================
# tmux Key Bindings
# Designed to match Zellij tmux mode keybindings
# =============================================================================

# =============================================================================
# Pane Navigation: h/j/k/l (matches Zellij tmux mode)
# =============================================================================
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# =============================================================================
# Pane Resize (single): H/J/K/L (matches Zellij tmux mode)
# =============================================================================
bind H resize-pane -L 5
bind J resize-pane -D 5
bind K resize-pane -U 5
bind L resize-pane -R 5

# =============================================================================
# Pane Split (matches Zellij)
# v: vertical split (new pane on right)
# s: horizontal split (new pane below)
# =============================================================================
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"

# =============================================================================
# Pane Management
# =============================================================================
# Close current pane (matches Zellij x)
bind x kill-pane

# Pane zoom toggle (matches Zellij f)
bind f resize-pane -Z

# Layout cycle (matches Zellij Space)
bind Space next-layout

# Synchronize panes (matches Zellij Tab Mode s)
bind z setw synchronize-panes

# Last pane (matches Zellij Pane Mode p)
bind \; last-pane

# Break pane to new window (matches Zellij Tab Mode b)
bind b break-pane

# =============================================================================
# Window/Tab Navigation: i/o (matches Zellij)
# =============================================================================
bind i previous-window
bind o next-window

# =============================================================================
# Window/Tab Reorder: I/O (matches Zellij)
# =============================================================================
bind I swap-window -t -1 \; previous-window
bind O swap-window -t +1 \; next-window

# =============================================================================
# Window/Tab Selection by Number: 1-9 (matches Zellij)
# =============================================================================
bind 1 select-window -t :1
bind 2 select-window -t :2
bind 3 select-window -t :3
bind 4 select-window -t :4
bind 5 select-window -t :5
bind 6 select-window -t :6
bind 7 select-window -t :7
bind 8 select-window -t :8
bind 9 select-window -t :9

# =============================================================================
# Window/Tab Management
# =============================================================================
# New window (matches Zellij c)
bind c new-window -c "#{pane_current_path}"

# Close window (matches Zellij X)
bind X kill-window

# Last window toggle (matches Zellij Tab Mode Tab)
bind Tab last-window

# Window list/tree (matches Zellij w for floating/session-manager)
bind w choose-tree -Zs

# =============================================================================
# Copy Mode (matches Zellij scroll/search modes)
# =============================================================================
# Enter copy mode (matches Zellij [)
bind [ copy-mode

# Enter copy mode with search (matches Zellij /)
bind / copy-mode \; send-keys ?

# =============================================================================
# Copy Mode Key Bindings (vi-style)
# =============================================================================
# Navigation
bind -T copy-mode-vi j send-keys -X cursor-down
bind -T copy-mode-vi k send-keys -X cursor-up
bind -T copy-mode-vi h send-keys -X cursor-left
bind -T copy-mode-vi l send-keys -X cursor-right

# Page navigation
bind -T copy-mode-vi C-f send-keys -X page-down
bind -T copy-mode-vi C-b send-keys -X page-up

# Half-page navigation (matches Zellij d/u)
bind -T copy-mode-vi d send-keys -X halfpage-down
bind -T copy-mode-vi u send-keys -X halfpage-up

# Selection and copy
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "clipboard-copy"

# Exit copy mode (matches Zellij Esc/q)
bind -T copy-mode-vi Escape send-keys -X cancel
bind -T copy-mode-vi q send-keys -X cancel

# Search navigation (matches Zellij n/p)
bind -T copy-mode-vi n send-keys -X search-again
bind -T copy-mode-vi p send-keys -X search-reverse

# Enter search from copy mode (matches Zellij scroll mode s)
bind -T copy-mode-vi s command-prompt -i -p "(search up)" "send -X search-backward-incremental \"%%\""

# =============================================================================
# Session Management
# =============================================================================
# Detach (matches Zellij d)
bind d detach-client

# Rename session (user requested: S)
bind S command-prompt -I "#S" "rename-session -- '%%'"

# =============================================================================
# Send Ctrl+a to terminal (matches Zellij a)
# =============================================================================
bind a send-prefix

# =============================================================================
# Submode Entry Keys (matches Zellij mode switching)
# =============================================================================
# These are defined in submodes.conf:
# r - Resize mode
# t - Tab mode
# p - Pane mode
# m - Move mode

# =============================================================================
# Popup Text Editor
# =============================================================================
# prefix + e: Open popup with Neovim to edit text, auto-paste on save
# NOTE: display-popup does not expand format strings (#{pane_id}) in -e option
# or command arguments. Use run-shell to expand and write to a file first.
bind e run-shell 'echo "#{pane_id}" > /tmp/popup-edit-target-pane' \; \
  display-popup -E -w 40% -h 50% -T " Edit " "popup-edit"
