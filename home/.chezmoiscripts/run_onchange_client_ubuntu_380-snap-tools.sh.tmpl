{{- if and (eq .chezmoi.os "linux") (eq (.profile | default "client") "client") (contains "debian" .chezmoi.osRelease.idLike) -}}
#!/usr/bin/env bash
# Install tools via snap
set -euo pipefail

log() { printf '%s\n' "==> $*"; }

if ! command -v snap >/dev/null 2>&1; then
    log "snap not available, skipping snap tools"
    exit 0
fi

LOCAL_BIN="$HOME/.local/bin"

# Install or migrate a tool to snap
# Usage: install_snap_tool <name>
install_snap_tool() {
    local name="$1"
    local local_bin="$LOCAL_BIN/$name"

    # Check if already installed via snap
    if snap list "$name" >/dev/null 2>&1; then
        log "skip (snap): $name"
        return 0
    fi

    log "Installing $name..."
    sudo snap install "$name"

    # Remove old local binary after successful snap install (migration from GitHub release)
    if [ -x "$local_bin" ]; then
        log "Removing old local binary: $local_bin"
        rm -f "$local_bin"
    fi
}

install_snap_tool btop
install_snap_tool glow

log "Snap tools installation complete"
{{- end -}}
