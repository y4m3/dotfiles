{{- if and (eq .chezmoi.os "linux") (eq (.profile | default "client") "client") (contains "debian" .chezmoi.osRelease.idLike) -}}
#!/usr/bin/env bash
# Install Go tools via go install
set -euo pipefail

log() { printf '%s\n' "==> $*"; }
err() { printf '%s\n' "Error: $*" >&2; }

GOROOT="$HOME/.local/go"
GO="$GOROOT/bin/go"
export GOBIN="${GOBIN:-$HOME/go/bin}"
mkdir -p "$GOBIN"
export PATH="$GOROOT/bin:$GOBIN:$PATH"

# Require Go under ~/.local/go (not just in PATH)
if [ ! -x "$GO" ]; then
    err "go not found at $GO. Install Go first."
    exit 1
fi

# Note: Using @latest for convenience and automatic updates.
# This means new versions are auto-installed on next run.
# For production environments, consider pinning to specific versions:
#   github.com/jesseduffield/lazygit@v0.40.2
#   github.com/jesseduffield/lazydocker@v0.23.0
#   github.com/mikefarah/yq/v4@v4.40.5

# lazygit
if [ ! -x "$GOBIN/lazygit" ]; then
    log "Installing lazygit..."
    go install github.com/jesseduffield/lazygit@latest
else
    log "skip (exists): $GOBIN/lazygit"
fi

# lazydocker
if [ ! -x "$GOBIN/lazydocker" ]; then
    log "Installing lazydocker..."
    go install github.com/jesseduffield/lazydocker@latest
else
    log "skip (exists): $GOBIN/lazydocker"
fi

# yq
if [ ! -x "$GOBIN/yq" ]; then
    log "Installing yq..."
    go install github.com/mikefarah/yq/v4@latest
else
    log "skip (exists): $GOBIN/yq"
fi

log "Go tools installation complete"
{{- end -}}
