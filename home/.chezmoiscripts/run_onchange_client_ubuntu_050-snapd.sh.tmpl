{{- if and (eq .chezmoi.os "linux") (eq (.profile | default "client") "client") (contains "debian" .chezmoi.osRelease.idLike) -}}
#!/usr/bin/env bash
# Install snapd (requires systemd)
set -euo pipefail

log() { printf '%s\n' "==> $*"; }

# Check if systemd is available
if ! command -v systemctl >/dev/null 2>&1; then
    log "systemd not available, skipping snapd installation"
    exit 0
fi

if ! systemctl is-system-running >/dev/null 2>&1; then
    log "systemd not running, skipping snapd installation"
    log "To enable systemd in WSL2, add to /etc/wsl.conf:"
    log "  [boot]"
    log "  systemd=true"
    exit 0
fi

if command -v snap >/dev/null 2>&1; then
    log "snapd already installed"
    exit 0
fi

log "Installing snapd..."
sudo apt-get update
sudo apt-get install -y snapd
sudo systemctl enable --now snapd.socket

# Wait for snapd to be ready
sleep 5
sudo snap wait system seed.loaded

log "snapd installed successfully"
{{- end -}}
