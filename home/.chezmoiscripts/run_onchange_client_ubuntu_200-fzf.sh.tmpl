{{- if and (eq .chezmoi.os "linux") (eq .profile "client") (contains "debian" .chezmoi.osRelease.idLike) -}}
#!/usr/bin/env bash
# Install fzf using official git clone + install method
set -euo pipefail

echo "==> Installing fzf..."

FZF_DIR="$HOME/.fzf"
FZF_BIN="$FZF_DIR/bin/fzf"

# Check if fzf is already installed
# Check both file existence and command availability (PATH may not be set correctly)
if [ -f "$FZF_BIN" ] || command -v fzf >/dev/null 2>&1; then
  # Try to get version from binary if available
  if [ -f "$FZF_BIN" ] && [ -x "$FZF_BIN" ]; then
    echo "✓ fzf already installed: $("$FZF_BIN" --version 2>/dev/null || echo "version unknown")"
  elif command -v fzf >/dev/null 2>&1; then
    echo "✓ fzf already installed: $(fzf --version 2>/dev/null || echo "version unknown")"
  else
    echo "✓ fzf already installed (binary found)"
  fi
  exit 0
fi

if [ -d "$FZF_DIR" ]; then
  echo "Updating existing fzf installation..."
  cd "$FZF_DIR"
  git pull
else
  echo "Cloning fzf repository..."
  git clone --depth 1 https://github.com/junegunn/fzf.git "$FZF_DIR"
fi

# Run official install script (no plugin manager, no key bindings auto-setup)
# Pipe 'y' to answer "yes" to interactive prompts
# Filter out the interactive prompt message, but preserve other output and errors
if ! install_output=$(echo "y" | "$FZF_DIR/install" --no-update-rc 2>&1); then
  echo "Error: fzf installation failed" >&2
  echo "$install_output" >&2
  exit 1
fi
echo "$install_output" | grep -v "^Do you want"

echo "✓ fzf installed to $FZF_DIR"
{{- end -}}
