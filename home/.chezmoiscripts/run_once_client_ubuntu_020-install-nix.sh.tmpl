{{- if and (eq .chezmoi.os "linux") (eq (.profile | default "client") "client") (contains "debian" .chezmoi.osRelease.idLike) -}}
#!/usr/bin/env bash
# Nix installation using Determinate Systems installer

set -euo pipefail

if command -v nix &>/dev/null; then
  echo "✓ Nix is already installed"
  exit 0
fi

echo "==> Installing Nix (Determinate Systems installer)..."

# Check if systemd is available
if pidof systemd &>/dev/null; then
  curl --proto '=https' --tlsv1.2 -sSf -L https://install.determinate.systems/nix |
    sh -s -- install --no-confirm
else
  echo "  (systemd not detected, using --init none)"
  curl --proto '=https' --tlsv1.2 -sSf -L https://install.determinate.systems/nix |
    sh -s -- install linux --init none --no-confirm
fi

echo ""
echo "✓ Nix installation complete. Home Manager will be applied next."
{{- end }}
