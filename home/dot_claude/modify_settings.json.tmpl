{{- if eq .chezmoi.os "linux" -}}
#!/bin/bash
# Merge hooks into existing settings.json (preserve plugins, etc.)

existing=$(cat)

# If no existing file or empty, create new
if [[ -z "$existing" ]] || [[ "$existing" == "{}" ]]; then
  cat <<'EOF'
{
  "hooks": {
    "Notification": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash $HOME/.claude/hooks/notify-waiting.sh"
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash $HOME/.claude/hooks/notify-stop.sh"
          }
        ]
      }
    ]
  }
}
EOF
  exit 0
fi

# Merge hooks into existing config using jq
hooks='{
  "hooks": {
    "Notification": [{"hooks": [{"type": "command", "command": "bash $HOME/.claude/hooks/notify-waiting.sh"}]}],
    "Stop": [{"hooks": [{"type": "command", "command": "bash $HOME/.claude/hooks/notify-stop.sh"}]}]
  }
}'

echo "$existing" | jq --argjson hooks "$hooks" '. * $hooks'
{{- end -}}
