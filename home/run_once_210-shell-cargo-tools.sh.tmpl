#!/usr/bin/env bash
# Install common CLI tools via Cargo
set -euo pipefail

echo "==> Installing cargo-installed CLI tools..."

# Load cargo env to ensure PATH/vars are set (handles non-interactive shells)
if [ -f "$HOME/.cargo/env" ]; then
    # shellcheck disable=SC1091
    source "$HOME/.cargo/env"
fi

# Ensure build tools present (needed for compiling eza and others)
if ! command -v gcc >/dev/null 2>&1; then
    echo "==> Installing build tools (gcc, make, etc.)..."
    sudo DEBIAN_FRONTEND=noninteractive apt-get update -y
    sudo DEBIAN_FRONTEND=noninteractive apt-get install -y build-essential pkg-config
fi

# Ensure cargo is available (rustup must have been installed by run_once_10)
if ! command -v cargo >/dev/null 2>&1; then
    echo "Error: cargo not found. Install Rust first (run_once_10-install-rust.sh)." >&2
    exit 1
fi

# Install tools (idempotent; cargo skips if already installed)
cargo install --locked \
    bat \
    eza \
    fd-find \
    ripgrep \
    starship \
    zoxide

echo "âœ“ Cargo tools installed"